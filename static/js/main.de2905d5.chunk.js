(this["webpackJsonpour-telepathy"]=this["webpackJsonpour-telepathy"]||[]).push([[0],{104:function(e,t,n){e.exports=n(152)},109:function(e,t,n){},152:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(9),c=n.n(o),i=(n(109),n(51)),s=n(12),u=n(35),l=n(17),f=n(181),m=n(184),d=n(45),b=n(53),g=n(85),h=new(function(){function e(){Object(d.a)(this,e),this.socket=Object(g.io)("https://localhost:8080"),this.myInfo=null}return Object(b.a)(e,[{key:"join",value:function(e){this.myInfo=e,this.socket.emit("join",e)}},{key:"onJoin",value:function(e,t){var n=this;this.socket.on("myInfo",(function(e){console.log(e),n.myInfo.id=e.id})),this.socket.on("userList",(function(t){console.log(t),t.forEach((function(t){e(t)}))})),this.socket.on("joinedUser",(function(t){e(t)})),this.socket.on("leavedUser",(function(e){t(e)}))}},{key:"offJoin",value:function(){this.socket.off("myInfo"),this.socket.off("userList"),this.socket.off("joinedUser"),this.socket.off("leavedUser")}},{key:"getMyInfo",value:function(){return this.myInfo}},{key:"changeStatus",value:function(e){this.socket.emit("changeStatus",e)}},{key:"onChangeStatus",value:function(e){this.socket.on("onChangeStatus",e)}},{key:"offChangeStatus",value:function(){this.socket.off("onChangeStatus")}},{key:"onError",value:function(e){console.error(e)}},{key:"onMessageReceived",value:function(e){this.socket.on("receivePrivateMessage",e)}},{key:"offMessageReceived",value:function(){this.socket.off("receivePrivateMessage")}},{key:"sendMessageToUser",value:function(e,t,n){var a={id:this.myInfo.id,type:e,message:n};this.socket.emit("privateMessage",t,a)}}]),e}()),p=n(186),O=n(187),v=n(194),j=n(188),E=n(195),w=n(58),y=n(189),k=n(190),S=n(183),C=Object(f.a)((function(e){return{orange:{color:e.palette.getContrastText(S.a[500]),backgroundColor:S.a[500]},cardHeader:{alignItems:"center"},cardContent:{display:"flex",justifyContent:"space-between"},cardStatusChip:{alignSelf:"center"},cardAction:{width:"100%"}}}));function I(e){var t=e.member,n=C(),o=Object(a.useState)(""),c=Object(l.a)(o,2),i=c[0],s=c[1],u=Object(a.useState)("primary"),f=Object(l.a)(u,2),d=f[0],b=f[1];return Object(a.useEffect)((function(){!function(e){switch(e){case"working":s("\uc5c5\ubb34\uc911"),b("primary");break;case"meeting":s("\ud68c\uc758\uc911"),b("primary");break;case"meal":s("\uc2dd\uc0ac\uc911"),b("secondary");break;case"rest":s("\ud734\uc2dd\uc911"),b("secondary");break;case"offwork":s("\ud1f4\uadfc"),b("default");break;default:s("\uc5c5\ubb34\uc911"),b("primary")}}(t.status)})),r.a.createElement(m.a,{item:!0,xs:6,md:3},r.a.createElement(p.a,null,r.a.createElement(O.a,{className:n.cardHeader,action:r.a.createElement(v.a,{className:n.cardStatusChip,color:d,label:i})}),r.a.createElement(j.a,{className:n.cardContent},r.a.createElement(E.a,{className:n.orange},"O"),r.a.createElement(w.a,null,t.name)),r.a.createElement(y.a,null,r.a.createElement(k.a,{variant:"contained",color:"primary",className:n.cardAction},"Call"))))}var x=Object(f.a)({memberBox:{padding:"10px 40px",marginTop:"20px"}});function D(e){e.offerToMember;var t=Object(a.useState)([]),n=Object(l.a)(t,2),o=n[0],c=n[1],i=x();function s(e){c((function(t){return[].concat(Object(u.a)(t),[e])}))}function f(e){c((function(t){return t.filter((function(t){return t.id!==e}))}))}function d(e){var t=Object(u.a)(o).find((function(t){return t.id===e.id}));t&&(t.status=e.status,function(e){var t=Object(u.a)(o).findIndex((function(t){return t.id===e.id})),n=Object(u.a)(o);n[t]=e,c((function(){return n}))}(t))}return Object(a.useEffect)((function(){return h.onJoin(s,f),function(){h.offJoin()}})),Object(a.useEffect)((function(){return h.onChangeStatus(d),function(){h.offChangeStatus()}})),r.a.createElement(m.a,{container:!0,spacing:3,className:i.memberBox},o.map((function(e){return r.a.createElement(I,{key:e.id,member:e})})))}var N=n(24),T=n(15),M={id:"",name:"",team:"",status:""};var F="/timeline/ADD",A="/timeline/CLEAR",B=new Date;B.setHours(9,0,0,0);var L=new Date;L.setHours(18,0,0,0);var R={startDate:B.toISOString(),endDate:L.toISOString(),currentStatus:"",currentIndex:-1,timeline:[]};var H={getNewId:function(){return Math.round(99999999*Math.random())}},U=function e(t){Object(d.a)(this,e),this.status=t.status,this.buttonColor=t.buttonColor,this.lineColor=t.lineColor,this.label=t.label},P=new(function(){function e(){Object(d.a)(this,e),this.list=[new U({status:"working",buttonColor:"primary",lineColor:"#C6BDFB",label:"\uc5c5\ubb34\uc911"}),new U({status:"meeting",buttonColor:"primary",lineColor:"#86B7E5",label:"\ud68c\uc758\uc911"}),new U({status:"meal",buttonColor:"secondary",lineColor:"#75CD83",label:"\uc2dd\uc0ac\uc911"}),new U({status:"rest",buttonColor:"secondary",lineColor:"#FFCBC0",label:"\ud734\uc2dd\uc911"}),new U({status:"offwork",buttonColor:"default",lineColor:"#8F95A4",label:"\ud1f4\uadfc"})]}return Object(b.a)(e,[{key:"getStatus",value:function(e){var t=this.list.find((function(t){return t.status===e}));return t||new U({status:"default",buttonColor:"default",lineColor:"#eee",label:"\uc900\ube44\uc911"})}}]),e}()),_=Object(f.a)((function(e){return{orange:{color:e.palette.getContrastText(S.a[500]),backgroundColor:S.a[500]},cardHeader:{alignItems:"center"},cardContent:{display:"flex",justifyContent:"space-between"},cardStatusChip:{alignSelf:"center"},workingStatusButton:{color:"#5843BE"},restStatusButton:{color:"#FFA067"},offStatusButton:{color:"#282828"}}}));function J(e){var t=e.teamId,n=e.userName,o=_(),c=Object(a.useState)(""),i=Object(l.a)(c,2),s=i[0],u=i[1],f=Object(a.useState)("primary"),d=Object(l.a)(f,2),b=d[0],g=d[1],w=Object(N.c)((function(e){return e.myInfo})),y=Object(N.c)((function(e){return e.workingHours})),S=Object(N.b)();function C(e){var t,n=I(!0);S((t={status:e,timeline:{status:e,color:P.getStatus(e).lineColor,width:n,startDate:(new Date).toISOString(),lastDate:(new Date).toISOString()}},Object(T.a)({type:F},t)))}function I(e){var t=y.timeline[y.currentIndex],n=new Date(y.endDate)-new Date(y.startDate);return t?e?((new Date-new Date(t.lastDate))/n*100).toFixed(1):((new Date-new Date(t.startDate))/n*100).toFixed(1):((new Date-new Date(y.startDate))/n*100).toFixed(1)}function x(e){return e.getFullYear().toString()+(e.getMonth()+1).toString()+e.getDate().toString()}function D(e){S(function(e){return Object(T.a)({type:"/myInfo/CHANGE_STATUS"},e)}({status:e})),C(e);var t=P.getStatus(e);u(t.label),g(t.buttonColor)}return Object(a.useEffect)((function(){S(function(e){return Object(T.a)({type:"/myInfo/SET_MY_INFO"},e)}({id:w.id?w.id:H.getNewId(),name:n,team:t,status:w.status?w.status:"working"})),h.join(w),D(w.status)}),[]),Object(a.useEffect)((function(){h.changeStatus(w)}),[w]),Object(a.useEffect)((function(){x(new Date(y.startDate))!==x(new Date)&&S({type:A})}),[]),function(e,t){var n=Object(a.useRef)();Object(a.useEffect)((function(){n.current=e}),[e]),Object(a.useEffect)((function(){if(null!==t){var e=setInterval((function(){n.current()}),t);return function(){return clearInterval(e)}}}),[t])}((function(){var e;console.log({width:I(),index:y.currentIndex,lastDate:(new Date).toISOString()}),S((e={width:I(),index:y.currentIndex,lastDate:(new Date).toISOString()},Object(T.a)({type:"/timeline/CHANGE_TIMELINE"},e)))}),[1e3]),r.a.createElement(p.a,{elevation:0},r.a.createElement(O.a,{className:o.cardHeader,avatar:r.a.createElement(E.a,{className:o.orange},"\uc751"),title:w.name,action:r.a.createElement(v.a,{className:o.cardStatusChip,color:b,label:s})}),r.a.createElement(j.a,{className:o.cardContent},P.list.map((function(e,t){return r.a.createElement(m.a,{key:t,item:!0,xs:"auto"},r.a.createElement(k.a,{variant:w.status===e.status?"contained":"text",color:b,onClick:function(){D(e.status)}},e.label))}))))}var G=n(63),W=n.n(G),Y=n(91),z={pcList:{},stream:null},K={iceServers:[{url:"stun:34.64.112.126:3478"},{url:"turn:34.64.112.126:3478?transport=udp",credential:"dmdcjfdl",username:"ekim"}],DtlsSrtpKeyAgreement:!0};function q(){return $.apply(this,arguments)}function $(){return($=Object(Y.a)(W.a.mark((function e(){return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!z.stream){e.next=2;break}return e.abrupt("return",z.stream);case 2:return e.next=4,navigator.mediaDevices.getUserMedia({audio:!0});case 4:return z.stream=e.sent,e.abrupt("return",z.stream);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){return new Promise((function(t,n){q().then((function(a){window.myStream=a;try{var r=new RTCPeerConnection(K);r.addStream(a),r.oniceconnectionstatechange=function(t){!function(e,t){console.log(e,t),console.log(z.pcList[e].connectionState),"connected"===z.pcList[e].connectionState&&console.log("connected")}(e,t)},z.pcList[e]=r,t(r)}catch(o){console.error(o),n(o)}}))}))}function V(e){console.error(e)}var X={getUserMedia:q,createOffer:function(e){return console.log("createOffer: "+e),new Promise((function(t,n){Q(e).then((function(n){z.pcList[e].createOffer((function(a){z.pcList[e].setLocalDescription(a),t({pc:n,sessionDescription:a})}),V)})).catch((function(e){n(e)}))}))},createAnswer:function(e){return new Promise((function(t){"connected"!==z.pcList[e].connectionState&&z.pcList[e].createAnswer((function(n){z.pcList[e].setLocalDescription(n),t(n)}),V)}))},receiveOffer:function(e,t){if(console.log("receiveOffer: "+e),!z.pcList[e])return new Promise((function(n){Q(e).then((function(e){e.setRemoteDescription(new RTCSessionDescription(t)),n(e)}))}))},receiveAnswer:function(e,t){z.pcList[e].setRemoteDescription(new RTCSessionDescription(t))},addIceCandidate:function(e,t){z.pcList[e]&&z.pcList[e].addIceCandidate(t)}},Z=n(191),ee=n(193),te=Object(f.a)({root:function(e){return{backgroundColor:e.line.color,width:"".concat(e.line.width,"%"),height:"100%",display:"inline-block","&:first-child":{borderRadius:"0.3rem 0 0 0.3rem"},"&:last-child":{minWidth:"3px",borderRadius:"0 0.3rem 0.3rem 0"}}}});function ne(e){var t=te(e);return r.a.createElement("span",{className:t.root})}function ae(e){var t=e.className,n=e.timeline;return r.a.createElement("div",{className:t},n.map((function(e,t){return r.a.createElement(ne,{key:t,line:e})})))}var re=Object(f.a)({progress:{height:"1.5rem",backgroundColor:"#fff",borderRadius:"0.3rem"}});function oe(){var e=re(),t=Object(N.c)((function(e){return e.workingHours}));return r.a.createElement(ee.a,null,r.a.createElement(ae,{className:e.progress,timeline:t.timeline}))}var ce=Object(f.a)({mainBox:{backgroundColor:"#F1F3F6",padding:"10px 20px"}});function ie(){var e=ce(),t=Object(s.g)(),n=t.teamId,o=t.userName;function c(e){switch(e.type){case"offer":X.receiveOffer(e.id,e.message).then((function(t){t.onicecandidate=function(t){i(e.id,t)},t.onaddstream=function(t){u(e.id,t)},t.onremovestream=l,X.createAnswer(e.id).then((function(t){h.sendMessageToUser("answer",e.id,t)}))}));break;case"answer":X.receiveAnswer(e.id,e.message);break;case"candidate":console.log("candidate"),console.log(e),X.addIceCandidate(e.id,e.message);break;default:console.log(e)}}function i(e,t){t.candidate&&h.sendMessageToUser("candidate",e,t.candidate)}function u(e,t){console.log(e,t)}function l(e){console.log(e)}return Object(a.useEffect)((function(){return h.onMessageReceived(c),function(){h.offMessageReceived()}})),r.a.createElement(Z.a,{maxWidth:"md"},r.a.createElement(m.a,{container:!0,spacing:3,className:e.mainBox},r.a.createElement(m.a,{item:!0,xs:12,md:12},r.a.createElement(w.a,null,"TeleTele")),r.a.createElement(m.a,{item:!0,xs:12,md:6},r.a.createElement(J,{userName:o,teamId:n})),r.a.createElement(m.a,{item:!0,xs:12,md:6},r.a.createElement(oe,null))),r.a.createElement(D,{className:e.mainBox,offerToMember:function(e){X.createOffer(e.id).then((function(t){var n=t.pc,a=t.sessionDescription;n.onicecandidate=function(t){i(e.id,t)},n.onaddstream=function(t){u(e.id,t)},n.onremovestream=l,h.sendMessageToUser("offer",e.id,a)}))}}))}var se=n(192),ue=Object(f.a)({home:{position:"absolute",display:"flex",width:"100%",height:"100%",justifyContent:"center",alignItems:"center",flexDirection:"column"},title:{height:"3rem",fontSize:"2rem"},startButton:{background:"linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)",color:"#fff",width:"200px",height:"50px",borderRadius:"30px",fontSize:"1.2rem"},joinButton:{fontSize:"1.2rem"}});function le(){var e=ue(),t=Object(s.f)(),n=Object(a.useState)(!1),o=Object(l.a)(n,2),c=o[0],i=o[1],u=Object(a.useState)(""),f=Object(l.a)(u,2),m=f[0],d=f[1],b=Object(a.useState)(""),g=Object(l.a)(b,2),h=g[0],p=g[1],O=Object(N.c)((function(e){return e.myInfo}));function v(e){if("Enter"===e.key){if(!c&&m.trim().length<=0)return;if(c&&h.trim().length<=0)return;c?i(!0):j()}}function j(){!c&&m.trim().length<=0||i(!0)}return Object(a.useEffect)((function(){O.id&&(d(O.team),p(O.name))}),[]),r.a.createElement(ee.a,{className:e.home},r.a.createElement("h2",{className:e.title},"TeleTele"),r.a.createElement("h3",null,!c&&r.a.createElement(r.a.Fragment,null,r.a.createElement(se.a,{label:"TEAM",className:e.joinTextField,onChange:function(e){d(e.target.value)},onKeyPress:v,value:m,required:!0}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(k.a,{className:e.startButton,onClick:j},"JOIN")),c&&r.a.createElement(r.a.Fragment,null,r.a.createElement(se.a,{label:"MY NAME",className:e.joinTextField,onChange:function(e){p(e.target.value)},onKeyPress:v,value:h,required:!0}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(k.a,{className:e.startButton,onClick:function(){c&&h.trim().length<=0||t.push("/team/".concat(m,"/").concat(h))}},"START"))))}var fe=function(){return r.a.createElement(i.a,{basename:"/our-telepathy"},r.a.createElement(s.c,null,r.a.createElement(s.a,{path:"/team/:teamId/:userName"},r.a.createElement(ie,null)),r.a.createElement(s.a,{path:"/"},r.a.createElement(le,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var me=n(28),de=n(48),be=n(57),ge=n.n(be),he={key:"root",storage:ge.a,whitelist:["myInfo","workingHours"]},pe=Object(me.a)({myInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"/myInfo/SET_MY_INFO":return Object(T.a)(Object(T.a)({},e),{},{id:t.id,name:t.name,team:t.team,status:t.status});case"/myInfo/CHANGE_STATUS":return Object(T.a)(Object(T.a)({},e),{},{status:t.status});default:return e}},workingHours:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case F:return Object(T.a)(Object(T.a)({},e),{},{currentIndex:e.currentIndex+1,currentStatus:t.status,timeline:[].concat(Object(u.a)(e.timeline),[Object(T.a)(Object(T.a)({},t.timeline),{},{index:e.currentIndex+1})])});case"/timeline/CHANGE_TIMELINE":return Object(T.a)(Object(T.a)({},e),{},{timeline:e.timeline.map((function(e){return e.index==t.index?Object(T.a)(Object(T.a)({},e),{},{width:t.width,lastDate:t.lastDate}):e}))});case A:return R;default:return e}}}),Oe=Object(de.a)(he,pe),ve=n(92),je={key:"root",storage:ge.a},Ee=Object(de.a)(je,Oe),we=Object(me.b)(Ee),ye=Object(de.b)(we);c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(N.a,{store:we},r.a.createElement(ve.a,{persistor:ye},r.a.createElement(fe,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[104,1,2]]]);
//# sourceMappingURL=main.de2905d5.chunk.js.map