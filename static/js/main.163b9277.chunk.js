(this["webpackJsonpour-telepathy"]=this["webpackJsonpour-telepathy"]||[]).push([[0],{137:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),c=n(7),r=n.n(c),i=(n(97),n(39)),s=n(9),u=n(35),l=n(22);function f(e){var t=e.memberList,n=e.offerToMember,c=Object(a.useRef)();return o.a.createElement("ul",null,t.map((function(e){return o.a.createElement("li",{key:e.key,onDoubleClick:function(){n(e)}},o.a.createElement("p",null,e.id),o.a.createElement("p",null,e.name),o.a.createElement("video",{ref:c,onClick:(t=e.stream,void(t&&(c.current.srcObject=t,c.current.autoplay="autoplay")))}));var t})))}var m=n(76),d=n(77),h=n(78),g=n(53),p=n.n(g),k=n(79),v={pcList:{},stream:null},y={iceServers:[{url:"stun:34.64.112.126:3478"},{url:"turn:34.64.112.126:3478?transport=udp",credential:"dmdcjfdl",username:"ekim"}],DtlsSrtpKeyAgreement:!0};function b(){return(b=Object(k.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!v.stream){e.next=2;break}return e.abrupt("return",v.stream);case 2:return e.next=4,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 4:return v.stream=e.sent,e.abrupt("return",v.stream);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return new Promise((function(t,n){(function(){return b.apply(this,arguments)})().then((function(a){window.myStream=a;try{var o=new RTCPeerConnection(y);o.addStream(a),o.oniceconnectionstatechange=function(t){!function(e,t){console.log(e,t),console.log(v.pcList[e].connectionState),"connected"===v.pcList[e].connectionState&&console.log("connected")}(e,t)},v.pcList[e]=o,t(o)}catch(c){console.error(c),n(c)}}))}))}function j(e){console.error(e)}var O={createOffer:function(e){return console.log("createOffer: "+e),new Promise((function(t,n){E(e).then((function(n){v.pcList[e].createOffer((function(a){v.pcList[e].setLocalDescription(a),t({pc:n,sessionDescription:a})}),j)})).catch((function(e){n(e)}))}))},createAnswer:function(e){return new Promise((function(t){"connected"!=v.pcList[e].connectionState&&v.pcList[e].createAnswer((function(n){v.pcList[e].setLocalDescription(n),t(n)}),j)}))},receiveOffer:function(e,t){if(console.log("receiveOffer: "+e),!v.pcList[e])return new Promise((function(n){E(e).then((function(e){e.setRemoteDescription(new RTCSessionDescription(t)),n(e)}))}))},receiveAnswer:function(e,t){v.pcList[e].setRemoteDescription(new RTCSessionDescription(t))},addIceCandidate:function(e,t){v.pcList[e]&&v.pcList[e].addIceCandidate(t)}},w={key:"",id:"",team:"",name:""},M=new(function(){function e(){Object(m.a)(this,e),this.socket=Object(h.io)("https://flawless-psyche-307902.du.r.appspot.com")}return Object(d.a)(e,[{key:"join",value:function(e){w.id=e.id,w.team=e.team,w.name=e.name,this.socket.emit("join",e)}},{key:"onJoin",value:function(e,t){this.socket.on("myInfo",(function(e){w.key=e.key})),this.socket.on("userList",(function(t){t.forEach((function(t){console.log(t),e(t)}))})),this.socket.on("joinedUser",(function(t){console.log(t),e(t)})),this.socket.on("leavedUser",(function(e){t(e)}))}},{key:"offJoin",value:function(){this.socket.off("myInfo"),this.socket.off("userList"),this.socket.off("joinedUser"),this.socket.off("leavedUser")}},{key:"getMyInfo",value:function(){return w}},{key:"sendChatMessageToAll",value:function(e,t){this.socket.emit("chatMessageToAll",e,t)}},{key:"onChatMessage",value:function(e){this.socket.on("receiveChatMessage",e)}},{key:"onError",value:function(e){console.error(e)}},{key:"onMessageReceived",value:function(e){this.socket.on("receivePrivateMessage",e)}},{key:"offMessageReceived",value:function(){this.socket.off("receivePrivateMessage")}},{key:"sendMessageToUser",value:function(e,t,n){var a={id:w.id,key:w.key,type:e,message:n};this.socket.emit("privateMessage",t,a)}}]),e}());var S={getNewId:function(){return Math.round(99999999*Math.random())}},C=n(166),L=n(168);function T(e){var t=e.sendMessage,n=Object(a.useState)(""),c=Object(l.a)(n,2),r=c[0],i=c[1];return o.a.createElement(o.a.Fragment,null,o.a.createElement(C.a,{value:r,onChange:function(e){i(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&(t(r),i((function(){return""})))}}),o.a.createElement(L.a,{onClick:function(){t(r),i((function(){return""}))}},"Send"))}function I(e){var t=e.chatList;return o.a.createElement("ul",null,t.map((function(e){return o.a.createElement("li",{key:e.key},o.a.createElement("p",null,e.name),o.a.createElement("p",null,e.message))})))}function A(){var e=Object(s.g)(),t=e.teamId,n=e.userName,c=Object(a.useState)({key:"",id:S.getNewId(),name:n,team:t}),r=Object(l.a)(c,2),m=r[0],d=(r[1],Object(a.useState)([])),h=Object(l.a)(d,2),g=h[0],p=h[1],k=Object(a.useState)([]),v=Object(l.a)(k,2),y=v[0],b=v[1];function E(e){b((function(t){return[].concat(Object(u.a)(t),[e])}))}function j(e){b((function(t){return t.filter((function(t){return t.key!==e}))}))}function w(e){p((function(t){return[].concat(Object(u.a)(t),[e])}))}function C(e){switch(e.type){case"offer":O.receiveOffer(e.id,e.message).then((function(t){t.onicecandidate=function(t){A(e.key,t)},t.onaddstream=function(t){R(e.key,t)},t.onremovestream=x,O.createAnswer(e.id).then((function(t){M.sendMessageToUser("answer",e.key,t)}))}));break;case"answer":O.receiveAnswer(e.id,e.message);break;case"candidate":console.log("candidate"),console.log(e),O.addIceCandidate(e.id,e.message);break;default:console.log(e)}}function A(e,t){t.candidate&&M.sendMessageToUser("candidate",e,t.candidate)}function R(e,t){console.log("handleRemoteStreamAdded"),console.log(t.stream),window.remoteStream[e]=t.stream;var n=Object(u.a)(y).find((function(t){return t.key===e}));n&&(n.stream=t.stream,function(e){var t=Object(u.a)(y).findIndex((function(t){return t.key===e.key})),n=Object(u.a)(y);n[t]=e,b((function(){return n}))}(n))}function x(e){console.log(e)}return Object(a.useEffect)((function(){M.join(m)}),[]),Object(a.useEffect)((function(){return M.onJoin(E,j),function(){M.offJoin()}})),Object(a.useEffect)((function(){M.onChatMessage(w)}),[]),Object(a.useEffect)((function(){return M.onMessageReceived(C),function(){M.offMessageReceived()}})),o.a.createElement("div",null,o.a.createElement("p",null,t,"\ud300\uacfc \ud568\uaed8\ud558\ub294 \uc911"),o.a.createElement(i.b,{to:"/"},"\uccab \ud398\uc774\uc9c0\ub85c \uac00\uae30"),o.a.createElement(L.a,{onClick:function(){console.log(y)}},"MemberListCheck"),o.a.createElement(f,{memberList:y,offerToMember:function(e){O.createOffer(e.id,e.key).then((function(t){var n=t.pc,a=t.sessionDescription;n.onicecandidate=function(t){A(e.key,t)},n.onaddstream=function(t){R(e.key,t)},n.onremovestream=x,M.sendMessageToUser("offer",e.key,a)}))}}),o.a.createElement(T,{sendMessage:function(e,t){!function(e){var t=M.getMyInfo();M.sendChatMessageToAll(t,e)}(e)}}),o.a.createElement(I,{chatList:g}))}window.remoteStream={};var R=n(165),x=n(167),D=Object(R.a)({home:{position:"absolute",display:"flex",width:"100%",height:"100%",justifyContent:"center",alignItems:"center",flexDirection:"column",color:"#fff",background:"linear-gradient(45deg, #2196F3 30%, #21CBF3 90%)"},title:{height:"3rem",fontSize:"2rem"},startButton:{background:"linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)",color:"#fff",width:"200px",height:"50px",borderRadius:"30px",fontSize:"1.2rem"},joinButton:{fontSize:"1.2rem",color:"#fff"}});function N(){var e=D(),t=Object(s.f)(),n=Object(a.useState)(!1),c=Object(l.a)(n,2),r=c[0],i=c[1],u=Object(a.useState)(""),f=Object(l.a)(u,2),m=f[0],d=f[1],h=Object(a.useState)(""),g=Object(l.a)(h,2),p=g[0],k=g[1];function v(e){"Enter"===e.key&&(r?y():i(!0))}function y(){t.push("/team/".concat(m,"/").concat(p))}return o.a.createElement(x.a,{className:e.home},o.a.createElement("h2",{className:e.title},"T E L E P A T H Y"),o.a.createElement("h3",null,!r&&o.a.createElement(o.a.Fragment,null,o.a.createElement(C.a,{label:"MY NAME",className:e.joinTextField,onChange:function(e){k(e.target.value)},onKeyPress:v,required:!0}),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement(L.a,{className:e.startButton,onClick:function(){i(!0)}},"START")),r&&o.a.createElement("div",null,o.a.createElement(L.a,{className:e.joinButton,onClick:y},"JOIN THE"),o.a.createElement(C.a,{label:"TEAM",className:e.joinTextField,onChange:function(e){d(e.target.value)},onKeyPress:v}))))}var P=function(){return o.a.createElement(i.a,null,o.a.createElement(s.c,null,o.a.createElement(s.a,{path:"/team/:teamId/:userName"},o.a.createElement(A,null)),o.a.createElement(s.a,{path:"/"},o.a.createElement(N,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(P,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},92:function(e,t,n){e.exports=n(137)},97:function(e,t,n){}},[[92,1,2]]]);
//# sourceMappingURL=main.163b9277.chunk.js.map