(this["webpackJsonpour-telepathy"]=this["webpackJsonpour-telepathy"]||[]).push([[0],{104:function(e,t,n){e.exports=n(152)},109:function(e,t,n){},152:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(9),o=n.n(c),i=(n(109),n(50)),s=n(12),u=n(35),l=n(17),f=n(181),m=n(184),d=n(83),g=n(84),b=n(85),h=new(function(){function e(){Object(d.a)(this,e),this.socket=Object(b.io)("https://flawless-psyche-307902.du.r.appspot.com"),this.myInfo=null}return Object(g.a)(e,[{key:"join",value:function(e){this.myInfo=e,this.socket.emit("join",e)}},{key:"onJoin",value:function(e,t){var n=this;this.socket.on("myInfo",(function(e){n.myInfo.id=e.id})),this.socket.on("userList",(function(t){t.forEach((function(t){e(t)}))})),this.socket.on("joinedUser",(function(t){e(t)})),this.socket.on("leavedUser",(function(e){t(e)}))}},{key:"offJoin",value:function(){this.socket.off("myInfo"),this.socket.off("userList"),this.socket.off("joinedUser"),this.socket.off("leavedUser")}},{key:"getMyInfo",value:function(){return this.myInfo}},{key:"changeStatus",value:function(e){this.socket.emit("changeStatus",e)}},{key:"onChangeStatus",value:function(e){this.socket.on("onChangeStatus",e)}},{key:"offChangeStatus",value:function(){this.socket.off("onChangeStatus")}},{key:"onError",value:function(e){console.error(e)}},{key:"onMessageReceived",value:function(e){this.socket.on("receivePrivateMessage",e)}},{key:"offMessageReceived",value:function(){this.socket.off("receivePrivateMessage")}},{key:"sendMessageToUser",value:function(e,t,n){var a={id:this.myInfo.id,type:e,message:n};this.socket.emit("privateMessage",t,a)}}]),e}()),p=n(186),E=n(187),v=n(194),O=n(188),j=n(195),k=n(56),w=n(189),y=n(190),S=n(183),x=Object(f.a)((function(e){return{orange:{color:e.palette.getContrastText(S.a[500]),backgroundColor:S.a[500]},cardHeader:{alignItems:"center"},cardContent:{display:"flex",justifyContent:"space-between"},cardStatusChip:{alignSelf:"center"},cardAction:{width:"100%"}}}));function C(e){var t=e.member,n=x(),c=Object(a.useState)(""),o=Object(l.a)(c,2),i=o[0],s=o[1],u=Object(a.useState)("primary"),f=Object(l.a)(u,2),d=f[0],g=f[1];return Object(a.useEffect)((function(){!function(e){switch(e){case"working":s("\uc5c5\ubb34\uc911"),g("primary");break;case"meeting":s("\ud68c\uc758\uc911"),g("primary");break;case"meal":s("\uc2dd\uc0ac\uc911"),g("secondary");break;case"rest":s("\ud734\uc2dd\uc911"),g("secondary");break;case"offwork":s("\ud1f4\uadfc"),g("default");break;default:s("\uc5c5\ubb34\uc911"),g("primary")}}(t.status)})),r.a.createElement(m.a,{item:!0,xs:6,md:3},r.a.createElement(p.a,null,r.a.createElement(E.a,{className:n.cardHeader,action:r.a.createElement(v.a,{className:n.cardStatusChip,color:d,label:i})}),r.a.createElement(O.a,{className:n.cardContent},r.a.createElement(j.a,{className:n.orange},"O"),r.a.createElement(k.a,null,t.name)),r.a.createElement(w.a,null,r.a.createElement(y.a,{variant:"contained",color:"primary",className:n.cardAction},"Call"))))}var I=Object(f.a)({memberBox:{padding:"10px 40px",marginTop:"20px"}});function D(e){e.offerToMember;var t=Object(a.useState)([]),n=Object(l.a)(t,2),c=n[0],o=n[1],i=I();function s(e){o((function(t){return[].concat(Object(u.a)(t),[e])}))}function f(e){o((function(t){return t.filter((function(t){return t.id!==e}))}))}function d(e){var t=Object(u.a)(c).find((function(t){return t.id===e.id}));t&&(t.status=e.status,function(e){var t=Object(u.a)(c).findIndex((function(t){return t.id===e.id})),n=Object(u.a)(c);n[t]=e,o((function(){return n}))}(t))}return Object(a.useEffect)((function(){return h.onJoin(s,f),function(){h.offJoin()}})),Object(a.useEffect)((function(){return h.onChangeStatus(d),function(){h.offChangeStatus()}})),r.a.createElement(m.a,{container:!0,spacing:3,className:i.memberBox},c.map((function(e){return r.a.createElement(C,{key:e.id,member:e})})))}var N=n(24),T=n(15),M={id:"",name:"",team:"",status:""};var A="/timeline/ADD",B="/timeline/CLEAR",F=new Date;F.setHours(9,0,0,0);var L=new Date;L.setHours(18,0,0,0);var R={startDate:F.toISOString(),endDate:L.toISOString(),currentStatus:"",lastIndex:-1,timeline:[]};var H={getNewId:function(){return Math.round(99999999*Math.random())}},U=Object(f.a)((function(e){return{orange:{color:e.palette.getContrastText(S.a[500]),backgroundColor:S.a[500]},cardHeader:{alignItems:"center"},cardContent:{display:"flex",justifyContent:"space-between"},cardStatusChip:{alignSelf:"center"},workingStatusButton:{color:"#5843BE"},restStatusButton:{color:"#FFA067"},offStatusButton:{color:"#282828"}}}));function P(e){var t=e.teamId,n=e.userName,c=U(),o=Object(a.useState)(""),i=Object(l.a)(o,2),s=i[0],u=i[1],f=Object(a.useState)("primary"),d=Object(l.a)(f,2),g=d[0],b=d[1],k=Object(N.c)((function(e){return e.myInfo})),w=Object(N.c)((function(e){return e.workingHours})),S=Object(N.b)();function x(e){var t,n=function(e){switch(e){case"working":return"#C6BDFB";case"rest":return"#FFCBC0";case"meal":return"#75CD83";case"meeting":return"#86B7E5";case"offwork":return"#8F95A4"}}(e),a=C();S((t={status:e,timeline:{status:e,color:n,width:a,startDate:(new Date).toISOString(),lastDate:(new Date).toISOString()}},Object(T.a)({type:A},t)))}function C(){var e=w.timeline[w.lastIndex],t=new Date(w.endDate)-new Date(w.startDate);return e?((new Date-new Date(e.startDate))/t*100).toFixed(1):((new Date-new Date(w.startDate))/t*100).toFixed(1)}function I(e){return e.getFullYear().toString()+(e.getMonth()+1).toString()+e.getDate().toString()}function D(e){switch(S(function(e){return Object(T.a)({type:"/myInfo/CHANGE_STATUS"},e)}({status:e})),x(e),e){case"working":u("\uc5c5\ubb34\uc911"),b("primary");break;case"meeting":u("\ud68c\uc758\uc911"),b("primary");break;case"meal":u("\uc2dd\uc0ac\uc911"),b("secondary");break;case"rest":u("\ud734\uc2dd\uc911"),b("secondary");break;case"offwork":u("\ud1f4\uadfc"),b("default");break;default:u("\uc5c5\ubb34\uc911"),b("primary")}}return Object(a.useEffect)((function(){S(function(e){return Object(T.a)({type:"/myInfo/SET_MY_INFO"},e)}({id:k.id?k.id:H.getNewId(),name:n,team:t,status:k.status?k.status:"working"})),h.join(k),D(k.status)}),[]),Object(a.useEffect)((function(){h.changeStatus(k)}),[k]),Object(a.useEffect)((function(){I(new Date(w.startDate))!==I(new Date)&&S({type:B})}),[]),function(e,t){var n=Object(a.useRef)();Object(a.useEffect)((function(){n.current=e}),[e]),Object(a.useEffect)((function(){if(null!==t){var e=setInterval((function(){n.current()}),t);return function(){return clearInterval(e)}}}),[t])}((function(){var e;S((e={width:C(),index:w.lastIndex,lastDate:(new Date).toISOString()},Object(T.a)({type:"/timeline/CHANGE_TIMELINE"},e)))}),[6e4]),r.a.createElement(p.a,{elevation:0},r.a.createElement(E.a,{className:c.cardHeader,avatar:r.a.createElement(j.a,{className:c.orange},"\uc751"),title:k.name,action:r.a.createElement(v.a,{className:c.cardStatusChip,color:g,label:s})}),r.a.createElement(O.a,{className:c.cardContent},r.a.createElement(m.a,{item:!0,xs:"auto"},r.a.createElement(y.a,{variant:"working"===k.status?"contained":"text",color:g,onClick:function(){D("working")}},"\uc5c5\ubb34")),r.a.createElement(m.a,{item:!0,xs:"auto"},r.a.createElement(y.a,{variant:"meeting"===k.status?"contained":"text",color:g,onClick:function(){D("meeting")}},"\ud68c\uc758")),r.a.createElement(m.a,{item:!0,xs:"auto"},r.a.createElement(y.a,{variant:"rest"===k.status?"contained":"text",color:g,onClick:function(){D("rest")}},"\ud734\uc2dd")),r.a.createElement(m.a,{item:!0,xs:"auto"},r.a.createElement(y.a,{variant:"meal"===k.status?"contained":"text",color:g,onClick:function(){D("meal")}},"\uc2dd\uc0ac")),r.a.createElement(m.a,{item:!0,xs:"auto"},r.a.createElement(y.a,{variant:"offwork"===k.status?"contained":"text",color:g,onClick:function(){D("offwork")}},"\ud1f4\uadfc"))))}var _=n(61),J=n.n(_),G=n(91),W={pcList:{},stream:null},Y={iceServers:[{url:"stun:34.64.112.126:3478"},{url:"turn:34.64.112.126:3478?transport=udp",credential:"dmdcjfdl",username:"ekim"}],DtlsSrtpKeyAgreement:!0};function z(){return K.apply(this,arguments)}function K(){return(K=Object(G.a)(J.a.mark((function e(){return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!W.stream){e.next=2;break}return e.abrupt("return",W.stream);case 2:return e.next=4,navigator.mediaDevices.getUserMedia({audio:!0});case 4:return W.stream=e.sent,e.abrupt("return",W.stream);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return new Promise((function(t,n){z().then((function(a){window.myStream=a;try{var r=new RTCPeerConnection(Y);r.addStream(a),r.oniceconnectionstatechange=function(t){!function(e,t){console.log(e,t),console.log(W.pcList[e].connectionState),"connected"===W.pcList[e].connectionState&&console.log("connected")}(e,t)},W.pcList[e]=r,t(r)}catch(c){console.error(c),n(c)}}))}))}function $(e){console.error(e)}var Q={getUserMedia:z,createOffer:function(e){return console.log("createOffer: "+e),new Promise((function(t,n){q(e).then((function(n){W.pcList[e].createOffer((function(a){W.pcList[e].setLocalDescription(a),t({pc:n,sessionDescription:a})}),$)})).catch((function(e){n(e)}))}))},createAnswer:function(e){return new Promise((function(t){"connected"!==W.pcList[e].connectionState&&W.pcList[e].createAnswer((function(n){W.pcList[e].setLocalDescription(n),t(n)}),$)}))},receiveOffer:function(e,t){if(console.log("receiveOffer: "+e),!W.pcList[e])return new Promise((function(n){q(e).then((function(e){e.setRemoteDescription(new RTCSessionDescription(t)),n(e)}))}))},receiveAnswer:function(e,t){W.pcList[e].setRemoteDescription(new RTCSessionDescription(t))},addIceCandidate:function(e,t){W.pcList[e]&&W.pcList[e].addIceCandidate(t)}},V=n(191),X=n(193),Z=Object(f.a)({root:function(e){return{backgroundColor:e.line.color,width:"".concat(e.line.width,"%"),height:"100%",display:"inline-block","&:first-child":{borderRadius:"0.3rem 0 0 0.3rem"},"&:last-child":{minWidth:"3px",borderRadius:"0 0.3rem 0.3rem 0"}}}});function ee(e){var t=Z(e);return r.a.createElement("span",{className:t.root})}function te(e){var t=e.className,n=e.timeline;return r.a.createElement("div",{className:t},n.map((function(e,t){return r.a.createElement(ee,{key:t,line:e})})))}var ne=Object(f.a)({progress:{height:"1.5rem",backgroundColor:"#fff",borderRadius:"0.3rem"}});function ae(){var e=ne(),t=Object(N.c)((function(e){return e.workingHours}));return r.a.createElement(X.a,null,r.a.createElement(te,{className:e.progress,timeline:t.timeline}))}var re=Object(f.a)({mainBox:{backgroundColor:"#F1F3F6",padding:"10px 20px"}});function ce(){var e=re(),t=Object(s.g)(),n=t.teamId,c=t.userName;function o(e){switch(e.type){case"offer":Q.receiveOffer(e.id,e.message).then((function(t){t.onicecandidate=function(t){i(e.id,t)},t.onaddstream=function(t){u(e.id,t)},t.onremovestream=l,Q.createAnswer(e.id).then((function(t){h.sendMessageToUser("answer",e.id,t)}))}));break;case"answer":Q.receiveAnswer(e.id,e.message);break;case"candidate":console.log("candidate"),console.log(e),Q.addIceCandidate(e.id,e.message);break;default:console.log(e)}}function i(e,t){t.candidate&&h.sendMessageToUser("candidate",e,t.candidate)}function u(e,t){console.log(e,t)}function l(e){console.log(e)}return Object(a.useEffect)((function(){return h.onMessageReceived(o),function(){h.offMessageReceived()}})),r.a.createElement(V.a,{maxWidth:"md"},r.a.createElement(m.a,{container:!0,spacing:3,className:e.mainBox},r.a.createElement(m.a,{item:!0,xs:12,md:12},r.a.createElement(k.a,null,"TeleTele")),r.a.createElement(m.a,{item:!0,xs:12,md:6},r.a.createElement(P,{userName:c,teamId:n})),r.a.createElement(m.a,{item:!0,xs:12,md:6},r.a.createElement(ae,null))),r.a.createElement(D,{className:e.mainBox,offerToMember:function(e){Q.createOffer(e.id).then((function(t){var n=t.pc,a=t.sessionDescription;n.onicecandidate=function(t){i(e.id,t)},n.onaddstream=function(t){u(e.id,t)},n.onremovestream=l,h.sendMessageToUser("offer",e.id,a)}))}}))}var oe=n(192),ie=Object(f.a)({home:{position:"absolute",display:"flex",width:"100%",height:"100%",justifyContent:"center",alignItems:"center",flexDirection:"column"},title:{height:"3rem",fontSize:"2rem"},startButton:{background:"linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)",color:"#fff",width:"200px",height:"50px",borderRadius:"30px",fontSize:"1.2rem"},joinButton:{fontSize:"1.2rem"}});function se(){var e=ie(),t=Object(s.f)(),n=Object(a.useState)(!1),c=Object(l.a)(n,2),o=c[0],i=c[1],u=Object(a.useState)(""),f=Object(l.a)(u,2),m=f[0],d=f[1],g=Object(a.useState)(""),b=Object(l.a)(g,2),h=b[0],p=b[1],E=Object(N.c)((function(e){return e.myInfo}));function v(e){if("Enter"===e.key){if(!o&&m.trim().length<=0)return;if(o&&h.trim().length<=0)return;o?i(!0):O()}}function O(){!o&&m.trim().length<=0||i(!0)}return Object(a.useEffect)((function(){E.id&&(d(E.team),p(E.name))}),[]),r.a.createElement(X.a,{className:e.home},r.a.createElement("h2",{className:e.title},"TeleTele"),r.a.createElement("h3",null,!o&&r.a.createElement(r.a.Fragment,null,r.a.createElement(oe.a,{label:"TEAM",className:e.joinTextField,onChange:function(e){d(e.target.value)},onKeyPress:v,value:m,required:!0}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(y.a,{className:e.startButton,onClick:O},"JOIN")),o&&r.a.createElement(r.a.Fragment,null,r.a.createElement(oe.a,{label:"MY NAME",className:e.joinTextField,onChange:function(e){p(e.target.value)},onKeyPress:v,value:h,required:!0}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(y.a,{className:e.startButton,onClick:function(){o&&h.trim().length<=0||t.push("/team/".concat(m,"/").concat(h))}},"START"))))}var ue=function(){return r.a.createElement(i.a,{basename:"/our-telepathy"},r.a.createElement(s.c,null,r.a.createElement(s.a,{path:"/team/:teamId/:userName"},r.a.createElement(ce,null)),r.a.createElement(s.a,{path:"/"},r.a.createElement(se,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var le=n(28),fe=n(47),me=n(55),de=n.n(me),ge={key:"root",storage:de.a,whitelist:["myInfo","workingHours"]},be=Object(le.a)({myInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"/myInfo/SET_MY_INFO":return Object(T.a)(Object(T.a)({},e),{},{id:t.id,name:t.name,team:t.team,status:t.status});case"/myInfo/CHANGE_STATUS":return Object(T.a)(Object(T.a)({},e),{},{status:t.status});default:return e}},workingHours:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case A:return Object(T.a)(Object(T.a)({},e),{},{lastIndex:e.lastIndex+1,currentStatus:t.status,timeline:[].concat(Object(u.a)(e.timeline),[Object(T.a)(Object(T.a)({},t.timeline),{},{index:e.lastIndex+1})])});case"/timeline/CHANGE_TIMELINE":return Object(T.a)(Object(T.a)({},e),{},{timeline:e.timeline.map((function(e){return e.index==t.index?Object(T.a)(Object(T.a)({},e),{},{width:t.width,lastDate:t.lastDate}):e}))});case B:return R;default:return e}}}),he=Object(fe.a)(ge,be),pe=n(92),Ee={key:"root",storage:de.a},ve=Object(fe.a)(Ee,he),Oe=Object(le.b)(ve),je=Object(fe.b)(Oe);o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(N.a,{store:Oe},r.a.createElement(pe.a,{persistor:je},r.a.createElement(ue,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[104,1,2]]]);
//# sourceMappingURL=main.6170abe9.chunk.js.map